package com.CPT.Admin.Servlet;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.MultipartConfig;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import javax.servlet.http.Part;

import com.CPT.DB.DBConnect;
import com.CPT.Dao.SanPhamDaoImpl;
import com.CPT.Entities.SanPham;

@WebServlet("/add")
@MultipartConfig
public class ThemSanPham extends HttpServlet {

	private static final long serialVersionUID = 1L;

	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		 try {
		        String iddanhmucStr = req.getParameter("iddm");
		        int iddm = 0;

		        // Convert the iddanhmuc string to an integer
		        try {
		            iddm = Integer.parseInt(iddanhmucStr);
		        } catch (NumberFormatException e) {
		            e.printStackTrace();
		            // Handle the error appropriately, maybe set an error message in the session and redirect
		            HttpSession session = req.getSession();
		            session.setAttribute("faileMg", "Invalid ID format!");
		            resp.sendRedirect("admin/ThemSP.jsp");
		            return;  // Exit the method early since we can't proceed with an invalid ID
		        }

		        String tensanpham = req.getParameter("names");
		        String giacu = req.getParameter("giacu");
		        String giamoi = req.getParameter("giamoi");
		        String mota = req.getParameter("mota");
		        Part pt = req.getPart("ha");
		        String filename = pt.getSubmittedFileName();
		        String ngaytao = req.getParameter("ngaytao");
		        String ngaysua = req.getParameter("ngaysua");

		        // Create the SanPham object with the parsed iddm
		        SanPham s = new SanPham(iddm, tensanpham, giacu, giamoi, mota, filename, ngaytao, ngaysua);

		        SanPhamDaoImpl dao = new SanPhamDaoImpl(DBConnect.getConnect());
		        boolean f = dao.addSanPham(s);

		        HttpSession session = req.getSession();

		        if (f) {
		            session.setAttribute("succMg", "add-sp successful");
		            resp.sendRedirect("admin/ThemSP.jsp");
		        } else {
		            session.setAttribute("faileMg", "Faileding!");
		            resp.sendRedirect("admin/ThemSP.jsp");
		        }

		    } catch (Exception e) {
		        e.printStackTrace();
		    }
	}

}

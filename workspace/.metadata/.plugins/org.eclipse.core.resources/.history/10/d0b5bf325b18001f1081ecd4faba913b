package com.CPT.Admin.Servlet;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.CPT.DB.DBConnect;
import com.CPT.Dao.NguoiDungDaoImpl;
import com.CPT.Entities.NguoiDung;
import com.CPT.Utils.MaHoa;

@WebServlet("/Addtaikhoan")
public class AddTaiKhoans extends HttpServlet {

	private static final long serialVersionUID = 1L;

	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
//		
//		resp.setContentType("text/html");
//		resp.setCharacterEncoding("UTF-8");
//		req.setCharacterEncoding("UTF-8");
//		try {
//			int id = Integer.parseInt(req.getParameter("id"));
//			String Name = req.getParameter("names");
//			String Email = req.getParameter("emails");
//			String SDT = req.getParameter("phones");
//			String DiaCHi = req.getParameter("diachi");
//			String MK = req.getParameter("pass");
//			MK = MaHoa.toSha1(MK);
//			int IDvaitro = Integer.parseInt(req.getParameter("vaitro"));
//			
//			
//			NguoiDung sp = new NguoiDung(id, Name, Email, SDT, DiaCHi, MK, IDvaitro);
//
//			NguoiDungDaoImpl dao = new NguoiDungDaoImpl(DBConnect.getConnect());
//			boolean f = dao.addNguoiDung(sp);
//			HttpSession session = req.getSession();
//			if (f) {
//				session.setAttribute("succMsg", "Thêm tài khoản thành công");
//				resp.sendRedirect("admin/quanlyTaiKhoan.jsp");
//			} else {
//				session.setAttribute("faileMsg", "Lỗi!");
//				resp.sendRedirect("admin/UserAdd.jsp");
//				
//			}
//		}
//		catch (Exception e) {
//			e.printStackTrace();
//		}

		resp.setContentType("text/html");
		resp.setCharacterEncoding("UTF-8");
		req.setCharacterEncoding("UTF-8");

		try {
			// Lấy các thông tin từ request
			String name = req.getParameter("names");
			String email = req.getParameter("emails");
			String phone = req.getParameter("phones");
			String address = req.getParameter("diachi");
			String password = req.getParameter("pass");
			int roleId = Integer.parseInt(req.getParameter("vaitro"));

			// Tạo đối tượng người dùng mới
			NguoiDung user = new NguoiDung(name, email, phone, address, password, roleId);

			// Thực hiện thêm người dùng vào cơ sở dữ liệu
			NguoiDungDaoImpl dao = new NguoiDungDaoImpl(DBConnect.getConnect());
			boolean success = dao.addNguoiDung(user);

			// Xác định thông điệp và chuyển hướng
			String message;
			String destination;
			if (success) {
				message = "Thêm tài khoản thành công";
				destination = "admin/quanlyTaiKhoan.jsp";
			} else {
				message = "Lỗi khi thêm tài khoản";
				destination = "admin/UserAdd.jsp";
			}

			// Đặt thông điệp vào session và chuyển hướng
			HttpSession session = req.getSession();
			session.setAttribute("message", message);
			resp.sendRedirect(destination);
		} catch (Exception e) {
			e.printStackTrace();
			// Xử lý lỗi và hiển thị thông báo lỗi cho người dùng
			HttpSession session = req.getSession();
			session.setAttribute("message", "Có lỗi xảy ra: " + e.getMessage());
			resp.sendRedirect("admin/UserAdd.jsp");
		}
	}

}
